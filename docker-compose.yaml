services:
  redis:
    image: redis:7.4-alpine
    container_name: redis-container
    command: sh -c "exec redis-server --requirepass \"$REDIS_PASSWORD\" --save '' --appendonly no"
    volumes:
      - ./redis_data:/data
    ports:
      - "$REDIS_PORT:$REDIS_PORT"
    healthcheck:
      test: [ "CMD", "redis-cli", "--raw", "incr", "ping" ]

  server:
    build: ./src
    container_name: bot_api
    depends_on:
      redis:
        condition: service_healthy
        restart: true
    environment:
      REDIS_PORT: $REDIS_PORT
      BOT_TOKEN: $BOT_TOKEN
      REDIS_PASSWORD: $REDIS_PASSWORD
      REDIS_TTL: $REDIS_TTL
